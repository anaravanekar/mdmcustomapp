<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Accounts</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--<link href="../../vendor/jquery-ui-1.12.1/jquery-ui.css" rel="stylesheet"/>-->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.min.css" />
    <style type="text/css">
        .datatable-container {
            margin: 20px;
        }
    </style>
</head>

<body>

<div class="datatable-container data-container">
    <table id="accountTable" class="table table-striped table-bordered" cellspacing="0" width="100%">

        <thead>
        <!--       <tr>
<th>Name</th>
<th>Position</th>
<th>Office</th>
<th>Age</th>
<th>Start date</th>
<th>Salary</th>
</tr>-->
        </thead>
        <tfoot>
        <!--        <tr>
<th>Name</th>
<th>Position</th>
<th>Office</th>
<th>Age</th>
<th>Start date</th>
<th>Salary</th>
</tr>-->
        </tfoot>
        <tbody>
        <!--        <tr>
<td>Tiger Nixon</td>
<td>System Architect</td>
<td>Edinburgh</td>
<td>61</td>
<td>2011/04/25</td>
<td>$320,800</td>
</tr>-->
        </tbody>
    </table>
</div>
<div id="address-modals"></div>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.js"></script>
<!--<script src="../../vendor/jquery-ui-1.12.1/jquery-ui.js"></script>-->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/colreorder/1.4.1/js/dataTables.colReorder.min.js"></script>
<script type="text/javascript" th:inline="javascript">
        /*<![CDATA[*/
        $(document).ready(function() {
            var searchableColumns = [
                ["MDMACCOUNTID", 0],
                ["ACCOUNTNUMBER", 1],
                ["ACCOUNTNAME", 2],
                ["DAQAMETADATA_STATE", 4],
                ["DAQAMETADATA_CLUSTERID", 5]
            ];
            var searchableValues = [
                ["MDMACCOUNTID", ""],
                ["ACCOUNTNUMBER", ""],
                ["ACCOUNTNAME", ""],
                ["DAQAMETADATA_STATE", ""],
                ["DAQAMETADATA_CLUSTERID", ""]
            ];
            var searchableColumnsMap = new Map();
            searchableColumnsMap.set("MDMACCOUNTID", 0);
            searchableColumnsMap.set("ACCOUNTNUMBER", 1);
            searchableColumnsMap.set("ACCOUNTNAME", 2);
            searchableColumnsMap.set("DAQAMETADATA_STATE", 4);
            searchableColumnsMap.set("DAQAMETADATA_CLUSTERID", 5);

            var searchValuesMap = new Map();
            searchValuesMap.set("MDMACCOUNTID", "");
            searchValuesMap.set("ACCOUNTNUMBER", "");
            searchValuesMap.set("ACCOUNTNAME", "");
            searchValuesMap.set("DAQAMETADATA_STATE", "");
            searchValuesMap.set("DAQAMETADATA_CLUSTERID", "");

            //console.log("initializing table");
            //console.log($("#accountTable").html());
            var accountTable = $('#accountTable').DataTable({
                "dom": '<"toolbar">rtip',
                processing: true,
                serverSide: true,
                ajax: {
                    url: 'accounts',
                    type: 'POST'
                },
                scrollY: false,
                scrollX: true,
                columns: [{
                        'title': 'MDM Account Id',
                        'data': 'MDMACCOUNTID',
                        'name': 'MDMACCOUNTID',
                        'searchable': true
                    },
                    {
                        'title': 'Account Number',
                        'data': 'ACCOUNTNUMBER',
                        'name': 'ACCOUNTNUMBER',
                        'searchable': true
                    },
                    {
                        'title': 'Account Name',
                        'data': 'ACCOUNTNAME',
                        'name': 'ACCOUNTNAME',
                        'searchable': true
                    },
                    {
                        "title": 'Address',
                        "data": null,
                        "defaultContent": "<span class='addrlink glyphicon glyphicon-eject'></span>",
                        "searchable": false,
                        "orderable": false
                    },
                    {
                        'title': 'State',
                        'data': 'DAQAMETADATA_STATE',
                        'name': 'DAQAMETADATA_STATE',
                        'searchable': true
                    },
                    {
                        'title': 'Cluster',
                        'data': 'DAQAMETADATA_CLUSTERID',
                        'name': 'DAQAMETADATA_CLUSTERID',
                        'searchable': true
                    },
                    {
                        'title': 'Score(%)',
                        'data': 'DAQAMETADATA_SCORE',
                        'name': 'DAQAMETADATA_SCORE',
                        'searchable': false
                    },
                    {
                        'title': 'Target record',
                        'data': 'DAQAMETADATA_TARGETRECORD_',
                        'name': 'DAQAMETADATA_TARGETRECORD_',
                        'searchable': false
                    },
                    {
                        'title': 'Status',
                        'data': 'STATUS',
                        'name': 'STATUS',
                        'searchable': false
                    },
                    {
                        'title': 'System Id',
                        'data': 'SYSTEMID',
                        'name': 'SYSTEMID',
                        'searchable': false
                    },
                    {
                        'title': 'System Name',
                        'data': 'SYSTEMNAME',
                        'name': 'SYSTEMNAME',
                        'searchable': false
                    },
                    {
                        'title': 'Customer Type',
                        'data': 'CUSTOMERTYPE',
                        'name': 'CUSTOMERTYPE',
                        'searchable': false
                    },
                    {
                        'title': 'Registry Id',
                        'data': 'REGISTRYID',
                        'name': 'REGISTRYID',
                        'searchable': false
                    },
                    {
                        'title': 'Alias',
                        'data': 'ALIAS',
                        'name': 'ALIAS',
                        'searchable': false
                    },
                    {
                        'title': 'Name Pronunciation',
                        'data': 'NAMEPRONUNCIATION',
                        'name': 'NAMEPRONUNCIATION',
                        'searchable': false
                    },
                    {
                        'title': 'Taxpayer Id',
                        'data': 'TAXPAYERID',
                        'name': 'TAXPAYERID',
                        'searchable': false
                    },
                    {
                        'title': 'Tax Registration Number',
                        'data': 'TAXREGISTRATIONNUMBER',
                        'name': 'TAXREGISTRATIONNUMBER',
                        'searchable': false
                    },
                    {
                        'title': 'Customer Category',
                        'data': 'CUSTOMERCATEGORY',
                        'name': 'CUSTOMERCATEGORY',
                        'searchable': false
                    },
                    {
                        'title': 'Account Description',
                        'data': 'ACCOUNTDESCRIPTION',
                        'name': 'ACCOUNTDESCRIPTION',
                        'searchable': false
                    },
                    {
                        'title': 'Region',
                        'data': 'REGION',
                        'name': 'REGION',
                        'searchable': false
                    },
                    {
                        'title': 'Classification',
                        'data': 'CLASSIFICATION',
                        'name': 'CLASSIFICATION',
                        'searchable': false
                    },
                    {
                        'title': 'Account Type',
                        'data': 'ACCOUNTTYPE',
                        'name': 'ACCOUNTTYPE',
                        'searchable': false
                    },
                    {
                        'title': 'Sales Channel',
                        'data': 'SALESCHANNEL',
                        'name': 'SALESCHANNEL',
                        'searchable': false
                    },
                    {
                        'title': 'Reference',
                        'data': 'REFERENCE',
                        'name': 'REFERENCE',
                        'searchable': false
                    },
                    {
                        'title': 'NLS Language Code',
                        'data': 'NLSLANGUAGECODE',
                        'name': 'NLSLANGUAGECODE',
                        'searchable': false
                    },
                    {
                        'title': 'Name Local Language',
                        'data': 'NAMELOCALLANGUAGE',
                        'name': 'NAMELOCALLANGUAGE',
                        'searchable': false
                    },
                    {
                        'title': 'Customer Screening',
                        'data': 'CUSTOMERSCREENING',
                        'name': 'CUSTOMERSCREENING',
                        'searchable': false
                    },
                    {
                        'title': 'Last Credit Review Date',
                        'data': 'LASTCREDITREVIEWDATE',
                        'name': 'LASTCREDITREVIEWDATE',
                        'searchable': false
                    },
                    {
                        'title': 'Next Credit Review Date',
                        'data': 'NEXTCREDITREVIEWDATE',
                        'name': 'NEXTCREDITREVIEWDATE',
                        'searchable': false
                    },
                    {
                        'title': 'Credit Review Cycle',
                        'data': 'CREDITREVIEWCYCLE',
                        'name': 'CREDITREVIEWCYCLE',
                        'searchable': false
                    },
                    {
                        'title': 'Parent Party',
                        'data': 'PARENTPARTY',
                        'name': 'PARENTPARTY',
                        'searchable': false
                    },
                    {
                        'title': 'Emg Last Trans',
                        'data': 'EMGLASTTRANS',
                        'name': 'EMGLASTTRANS',
                        'searchable': false
                    },
                    {
                        'title': 'Grouping Description',
                        'data': 'GROUPINGDESCRIPTION',
                        'name': 'GROUPINGDESCRIPTION',
                        'searchable': false
                    },
                    {
                        'title': 'Grouping Id',
                        'data': 'GROUPINGID',
                        'name': 'GROUPINGID',
                        'searchable': false
                    },
                    {
                        'title': 'IXIA Classification',
                        'data': 'IXIACLASSIFICATION',
                        'name': 'IXIACLASSIFICATION',
                        'searchable': false
                    },
                    {
                        'title': 'Profile Class',
                        'data': 'PROFILECLASS',
                        'name': 'PROFILECLASS',
                        'searchable': false
                    }
                ],
                /*colReorder: {
                    realtime: false
                },*/
                "initComplete": function(settings, json) {
                    //console.log('init complete');
                    $('#clearSearch').on('click', function(e) {
                        //console.log("clear clicked");
                         $('#searchText').val('');
                        accountTable.search('').columns().search('').draw();
                    });

                    $('#searchSelect').on('change', function(e) {
                        //console.log("search changed");
                        $('#searchText').val('');
                        accountTable.search('').columns().search('').draw();
                    });

                    $('#searchText').on('keyup', function(e) {
                        var that = this;
                        if (e.keyCode == 13) {
                            var selectedColumnName = $("#searchSelect").val();
                            //console.log("selectedColumnName=" + selectedColumnName);
                            var colIndex = searchableColumnsMap.get(selectedColumnName);
                            //console.log('colIndex=' + colIndex);
                            if (accountTable.column(colIndex).search() != that.value) {
                                searchValuesMap.set(that.name, that.value);
                                accountTable
                                    .column(colIndex)
                                    .search(that.value)
                                    .draw();
                            }
                        }
                    });

                    $("#accountTable").on('click', '.addrlink', function() {
                        var rowData = accountTable.cell(this.parentElement).data();
                        var accountName = rowData["ACCOUNTNAME"];
                        var mdmId = rowData["MDMACCOUNTID"];
                        var accountNumber = rowData["ACCOUNTNUMBER"];
                        //console.log(rowData);
                        //console.log(rowData["ACCOUNTNAME"]);
                        //console.log($('#' + mdmId + '-addresses').length);
                        if ($('#' + mdmId + '-addresses').length > 0) {} else {
                            $("#address-modals").append("<div id='" + mdmId + "-addresses' style='display: none'><b>Loading...</b></div>");
                            $.ajax({
                                url: "account/" + mdmId + "/addressnew",
                                success: function(data) {
                                    $("#" + mdmId + '-addresses').html(data);
                                    $("#addressTable" + mdmId).DataTable({
                                        scrollY: "200px",
                                        scrollX: true,
                                        colReorder: true
                                    });
                                }
                            });
                            $("#" + mdmId + '-addresses').dialog({
                                /*height: 'auto',*/
                                minHeight: 310,
                                /* height: 310,*/
                                /* width: 1200, */
                                minWidth: 1200,
                                title: "Addresses for " + accountName + " Account No. " + accountNumber,
                                close: function(e, ui) {
                                    $(this).dialog('destroy').remove();
                                }
                            });
                        }
                    });
                } //init complete
            }); //dataTable initialization

            var searchHtml = '<label>Search&nbsp;&nbsp;&nbsp;</label><select id="searchSelect"><option value="DAQAMETADATA_CLUSTERID">Cluster Id&nbsp;</option><option value="MDMACCOUNTID">MDM Account Id&nbsp;</option><option value="ACCOUNTNUMBER">Account No&nbsp;</option><option value="ACCOUNTNAME">Account Name&nbsp;</option><option value="DAQAMETADATA_STATE">DQ State&nbsp;</option></select>&nbsp;&nbsp;&nbsp;<input id="searchText" name="searchText" type="text"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp<input id="clearSearch" value="Clear" type="button"/>';
            $("div.toolbar").html(searchHtml + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input id="addressByCluster" name="DAQAMETADATA_CLUSTERID_BUTTON" type="button" value="Get Addresses" />');

            $("#addressByCluster").on('click', function(e) {
                var selectedColumn = $("#searchSelect").val();
                if (selectedColumn == 'DAQAMETADATA_CLUSTERID') {
                    var clusterId = $("#searchText").val();
                    //console.log("clusterId=" + clusterId);
                    if (clusterId) {
                        if ($('#' + clusterId + '-claddresses').length > 0) {} else {
                            $("#address-modals").append("<div id='" + clusterId + "-claddresses' style='display: none'><b>Loading...</b></div>");
                            $.ajax({
                                url: "account/" + clusterId + "/claddress",
                                success: function(data) {
                                    $("#" + clusterId + '-claddresses').html(data);
                                    $("#addressTable" + clusterId).DataTable({
                                        scrollY: "200px",
                                        scrollX: true,
                                        colReorder: true
                                    });
                                }
                            });
                            $("#" + clusterId + '-claddresses').dialog({
                                /*height: 'auto',*/
                                minHeight: 310,
                                /* height: 310,*/
                                /* width: 1200, */
                                minWidth: 1200,
                                title: "Addresses for Account cluster id " + clusterId,
                                close: function(e, ui) {
                                    $(this).dialog('destroy').remove();
                                }
                            });
                        }
                    } else {
                        alert("Please enter search value for Cluster Id");
                    }
                }
            });
        }); //document ready
        /*]]>*/
    </script>


</body>

</html>