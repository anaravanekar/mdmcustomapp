<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Accounts</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="../../vendor/jquery-ui-1.12.1/jquery-ui.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="../../vendor/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css"/>
    <link rel="stylesheet" href="../../css/main.css" />
    <style type="text/css">
        .bs-example{
            margin: 20px;
        }
    </style>
</head>
<body>
<div id="acc-table" class="bs-example">
    <div class="table-responsive">
        <table id="accountTable" class="table display dataTable table-striped table-hover">
            <thead>
            <th>
                Addresses
            </th>
            <th th:each="column: ${columnlist}" th:text="${column}"></th>
            </thead>
            <tbody>
            <tr th:each="item : ${resultList}">
                <td><span th:id="${item.get('MDMACCOUNTID')}" th:attr="data-window='info_window' + ${item.get('MDMACCOUNTID')},data-accname=${item.get('ACCOUNTNAME')}" class="addrlink glyphicon glyphicon-eject"></span></td>
                <td th:each="entry : ${item}"
                    th:text="${entry.value}"></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<div th:id="'info_window' + ${item.get('MDMACCOUNTID')}" th:each="item : ${resultList}" style='display: none'>
    <b>Address</b>
</div>

<script src="../../vendor/jquery-ui-1.12.1/external/jquery/jquery.js"></script>
<script src="../../vendor/jquery-ui-1.12.1/jquery-ui.js"></script>
<script type="text/javascript"
        src="../../vendor/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript"
        src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../../vendor/ColReorder-1.4.1/js/dataTables.colReorder.min.js"></script>
<script type="text/javascript" src="../../vendor/FixedColumns-3.2.3/js/dataTables.fixedColumns.min.js"></script>
<script>
$(document).ready(function() {
    $("#accountTable").DataTable({
        ajax: "/accounts",
        colReorder: true,
        scrollY:        "450px",
        scrollX:        true,
        scrollCollapse: true,
        fixedColumns: {
            leftColumns: 1
        }
    });
/*    $("#accountTable .addrlink").on('click', function(){
        alert("button clicked 1");
    });*/
    $("#accountTable").on('click', '.addrlink', function(){
        var table = $("#accountTable").DataTable();
        var rowIdx = table.cell( this ).index().row;
        var colData = table.column(1).data();
        var rowData = table.row(rowIdx).data();
        console.log(rowData);
        console.log(colData);
        alert("button clicked hello.. wow "+rowIdx);
        var accId = $(this).attr('id');
        var title = "Account: "+$(this).data('accname');
        var windowElem = $(this).data('window');
        $.ajax({
            url: "/account/"+accId+"/address",
            success: function(data){
                $("#" + windowElem).html(data);
            }
        });
        //$("#" + windowElem).html($("#acc-table").html());
        $("#" + windowElem).dialog({
            height:'auto',
            maxHeight: 750,
            width:800,
            title: title
        });
    });
});
</script>
</body>
</html>